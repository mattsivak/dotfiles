yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"
sudo yabai --load-sa

yabai -m config layout bsp
yabai -m config window_placement second_child

yabai -m config top_padding    0
yabai -m config bottom_padding 0
yabai -m config left_padding   0 
#yabai -m config left_padding  260
yabai -m config right_padding  0
yabai -m config window_gap     0 

yabai -m config auto_balance on

# set mouse interaction modifier key (default: fn)
yabai -m config mouse_modifier alt

# set modifier + left-click drag to move window (default: move)
yabai -m config mouse_action1 move

# set modifier + right-click drag to resize window (default: resize)
yabai -m config mouse_action2 resize

# yabai -m config focus_follows_mouse autoraise
yabai -m config mouse_follows_focus on

yabai -m config window_shadow float

yabai -m config window_opacity off
yabai -m config active_window_opacity 1.0
yabai -m config normal_window_opacity 1.0

# yabai -m config menubar_opacity 1.0

# NOTCH_UUID="37D8832A-2D66-02CA-B9F7-8F30A301B230"
# NORMAL_BAR=10
# NOTCH_BAR=10

# yabai -m signal --add event=display_added action="if [[ \"\$(yabai -m query --displays | jq \".[\$YABAI_DISPLAY_ID].uuid\")\" =~ \"$NOTCH_UUID\" ]]; then yabai -m config external_bar main:$NORMAL_BAR:0; elif [[ \"\$(yabai -m query --displays | jq '.[].uuid')\" =~ \"$NOTCH_UUID\" ]]; then yabai -m config external_bar main:$NORMAL_BAR:0; else yabai -m config external_bar all:$NORMAL_BAR:0; fi"
# yabai -m signal --add event=display_removed action="if [[ \"\$(yabai -m query --displays | jq \".[\$YABAI_DISPLAY_ID].uuid\")\" =~ \"$NOTCH_UUID\" ]]; then yabai -m config external_bar all:$NORMAL_BAR:0; elif [[ \"\$(yabai -m query --displays | jq '.[].uuid')\" =~ \"$NOTCH_UUID\" ]]; then yabai -m config external_bar all:$NOTCH_BAR:0; fi"

# Detect internal display (MacBook screen) by UUID or dimensions
INTERNAL_DISPLAY=$(yabai -m query --displays | jq '.[] | select(.uuid == "37D8832A-2D66-02CA-B9F7-8F30A301B230") | .index')

if [ -n "$INTERNAL_DISPLAY" ]; then
    # Set padding on spaces that belong to the internal display
    INTERNAL_SPACES=$(yabai -m query --spaces | jq ".[] | select(.display == $INTERNAL_DISPLAY) | .index")
    
    for space in $INTERNAL_SPACES; do
        yabai -m config --space $space left_padding 260  # Padding for broken screen area
        yabai -m config --space $space right_padding 0
        yabai -m config --space $space top_padding 0
        yabai -m config --space $space bottom_padding 0
    done
    
    # Set padding for external displays to 0
    EXTERNAL_SPACES=$(yabai -m query --spaces | jq ".[] | select(.display != $INTERNAL_DISPLAY) | .index")
    for space in $EXTERNAL_SPACES; do
        yabai -m config --space $space left_padding 0
        yabai -m config --space $space right_padding 0  
        yabai -m config --space $space top_padding 0
        yabai -m config --space $space bottom_padding 0
    done
fi

# Add signal to handle new spaces dynamically
yabai -m signal --add event=space_created action='
    CURRENT_SPACE=$(yabai -m query --spaces --space | jq .index)
    CURRENT_DISPLAY=$(yabai -m query --spaces --space | jq .display)
    DISPLAY_UUID=$(yabai -m query --displays --display $CURRENT_DISPLAY | jq -r .uuid)
    
    if [ "$DISPLAY_UUID" = "37D8832A-2D66-02CA-B9F7-8F30A301B230" ]; then
        yabai -m config --space $CURRENT_SPACE left_padding 260
        yabai -m config --space $CURRENT_SPACE right_padding 0
        yabai -m config --space $CURRENT_SPACE top_padding 0
        yabai -m config --space $CURRENT_SPACE bottom_padding 0
    else
        yabai -m config --space $CURRENT_SPACE left_padding 0
        yabai -m config --space $CURRENT_SPACE right_padding 0
        yabai -m config --space $CURRENT_SPACE top_padding 0
        yabai -m config --space $CURRENT_SPACE bottom_padding 0
    fi
'

# global settings
if [[ "$(yabai -m query --displays | jq '.[].uuid')" =~ "$NOTCH_UUID" ]]; then if [ "$(yabai -m query --displays | jq length)" -gt "1" ]; then yabai -m config external_bar main:$NORMAL_BAR:0; else yabai -m config external_bar all:$NOTCH_BAR:0; fi else yabai -m config external_bar all:$NORMAL_BAR:0; fi

yabai -m rule --add app="^System Preferences$" manage=off
yabai -m rule --add app="^Digital Colou?r Meter$" sticky=on

yabai -m config window_animation_duration 0.10
yabai -m config window_animation_easing easeInOutCirc

yabai -m signal --add event=window_focused action="yabai -m config window_opacity on"
